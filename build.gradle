/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */

plugins {
    id 'jacoco'
    id 'idea'
    id 'eclipse'
    id 'checkstyle'
    id 'com.github.johnrengelman.shadow' version '4.0.4' apply false
    id 'java'
    
}

allprojects {
    repositories {
        jcenter()
    }
    group "nl.tudelft.gogreen"
    sourceCompatibility = targetCompatibility = 1.8

    javadoc {
        destinationDir = file("${rootProject.projectDir}build/javadoc")
        options.addBooleanOption('html5', true)

    }
}

subprojects {
    version = '1.0'

    apply plugin: 'com.github.johnrengelman.shadow'
    apply plugin: 'checkstyle'
    apply plugin: 'java'
    apply plugin: 'jacoco'

    checkstyle {
        configFile rootProject.file('CSE1105.checkstyle.xml')
        checkstyleTest.enabled = false
    }

    jacocoTestReport {
        additionalSourceDirs.from = files(sourceSets.main.allSource.srcDirs)
        sourceDirectories.from = files(sourceSets.main.allSource.srcDirs)
        classDirectories.from =  files(sourceSets.main.output)
        reports {
            html.enabled = true
            xml.enabled = true
            csv.enabled = false
        }
    }
}


task jacocoRootReport(type: JacocoReport) {
    dependsOn = subprojects.test
    additionalSourceDirs.from = files(subprojects.sourceSets.main.allSource.srcDirs)
    sourceDirectories.from = files(subprojects.sourceSets.main.allSource.srcDirs)
    classDirectories.from =  files(subprojects.sourceSets.main.output)
    executionData.from = files(subprojects.jacocoTestReport.executionData)
    reports {
        html.enabled = true
        xml.enabled = true
        csv.enabled = false
    }

    onlyIf = {
        true
    }
    doFirst {
        executionData.from = files(executionData.findAll {
            it.exists()
        })
    }
}